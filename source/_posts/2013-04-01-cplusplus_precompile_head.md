---
layout: post
title: "C++预编译头小记"
date: 2013-04-01 14:10
comments: true
categories:  c++
---

随着功能的不断增加，工程逐渐庞大，编译、链接时间明显变长，于是考虑进行优化。在多人进行开发，而没有代码质量监控的话，确实很容易造成这样的结果，尽早发现和解决这些问题，可以避免更大的麻烦。
<!--more-->
现在所遇到的问题主要有：

1. 模板的大量使用
2. 头文件包含混乱
3. 头文件中直接定义

首先考虑采用预编译头文件方式处理。

预编译头(Precompile head)

**/Yc**

创建预编译头PCH, VC中通过设置.cpp文件的属性来设置预编译的源文件，命令行通过命令 cl /Yc stdafx.h /Pf stdafx.h stdafx.cpp 来编译预编译文件

**/Yu**

使用预编译头PCH，VC中可以通过设置工程的预编译属性，来设置是否使用预编译头，同时也可以单独对.cpp文件设置是否使用预编译头。设置使用预编译头的工程，其中所有的.cpp文件都需要在文件的顶部#include stdafx.h 文件。注（stdafx.h stdafx.cpp文件是VC创建工程时，如果需要预编译头，则自动创建的，也可以自己手动添加或指定其他文件为预编译头）

**要点**

创建、使用、#include 的预编译头文件路径需要一致，不一致（缩写）视为不同
在编译单元中重复#include与编译头文件中引用的文件，尽量保证路径一致（相同路径串），否则与编译无效

/Zmnumber 设置与编译内存使用大小，创建和使用预编译头的文件都需要设置相同的参数。number 是比例因子，其默认值为 100，指定分配 50MB 内存。number 的最大值为 2000。下表说明 number 如何修改内存分配：

	number 内存分配 
	10     5.0 MB 
	100    50 MB 
	200    100 MB 
	1000   500 MB 
	2000   1000 MB 


但是，正如前面所的只有尽早发现才能避免大麻烦，由于工程太多，采用预编译头的方式进行优化的可操作性太差，于是没有采用。
